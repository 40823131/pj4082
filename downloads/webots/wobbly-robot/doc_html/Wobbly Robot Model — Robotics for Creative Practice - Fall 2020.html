<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>Wobbly Robot Model — Robotics for Creative Practice - Fall 2020</title>
    <link rel="stylesheet" href="Wobbly%20Robot%20Model%20%E2%80%94%20Robotics%20for%20Creative%20Practice%20-%20Fall%202020_files/haiku.css" type="text/css">
    <link rel="stylesheet" href="Wobbly%20Robot%20Model%20%E2%80%94%20Robotics%20for%20Creative%20Practice%20-%20Fall%202020_files/pygments.css" type="text/css">
    <link rel="stylesheet" type="text/css" href="Wobbly%20Robot%20Model%20%E2%80%94%20Robotics%20for%20Creative%20Practice%20-%20Fall%202020_files/graphviz.css">
    <link rel="stylesheet" href="Wobbly%20Robot%20Model%20%E2%80%94%20Robotics%20for%20Creative%20Practice%20-%20Fall%202020_files/guide.css" type="text/css">
    <script id="documentation_options" data-url_root="../" src="Wobbly%20Robot%20Model%20%E2%80%94%20Robotics%20for%20Creative%20Practice%20-%20Fall%202020_files/documentation_options.js"></script>
    <script src="Wobbly%20Robot%20Model%20%E2%80%94%20Robotics%20for%20Creative%20Practice%20-%20Fall%202020_files/jquery.js"></script>
    <script src="Wobbly%20Robot%20Model%20%E2%80%94%20Robotics%20for%20Creative%20Practice%20-%20Fall%202020_files/underscore.js"></script>
    <script src="Wobbly%20Robot%20Model%20%E2%80%94%20Robotics%20for%20Creative%20Practice%20-%20Fall%202020_files/doctools.js"></script>
    <script src="Wobbly%20Robot%20Model%20%E2%80%94%20Robotics%20for%20Creative%20Practice%20-%20Fall%202020_files/language_data.js"></script>
    <link rel="index" title="Index" href="https://courses.ideate.cmu.edu/16-375/f2020/text/genindex.html">
    <link rel="search" title="Search" href="https://courses.ideate.cmu.edu/16-375/f2020/text/search.html">
    <link rel="next" title="Delegate Robot Model" href="https://courses.ideate.cmu.edu/16-375/f2020/text/simulations/delegate.html">
    <link rel="prev" title="Clock Robot Model" href="https://courses.ideate.cmu.edu/16-375/f2020/text/simulations/clock.html"> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="https://courses.ideate.cmu.edu/16-375/f2020/text/index.html">
          <span>Robotics for Creative Practice - Fall 2020</span></a></h1>
        <h2 class="heading"><span>Wobbly Robot Model</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&nbsp;&nbsp;<a href="https://courses.ideate.cmu.edu/16-375/f2020/text/simulations/clock.html">Clock Robot Model</a>
        &nbsp;&nbsp;::&nbsp;&nbsp;
        <a class="uplink" href="https://courses.ideate.cmu.edu/16-375/f2020/text/index.html">Contents</a>
        &nbsp;&nbsp;::&nbsp;&nbsp;
        <a href="https://courses.ideate.cmu.edu/16-375/f2020/text/simulations/delegate.html">Delegate Robot Model</a>&nbsp;&nbsp;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <div class="section" id="wobbly-robot-model">
<span id="wobbly-model"></span><h1><a class="toc-backref" href="#id3">Wobbly Robot Model</a><a class="headerlink" href="#wobbly-robot-model" title="Permalink to this headline">¶</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">wobbly</span></code> robot model simulates a two-wheeled differential-drive mobile
robot with a low center of gravity.  The body is designed with enough ground
clearance to tilt, but the low center of mass will wobble it back upright.  The
body includes a mast with two distance sensors, a radio receiver and emitter,
GPS receiver for location, compass for heading, and three-axis accelerometer.
Each wheel has both a rotational motor and a position sensor.</p>
<p>The shape is constructed entirely of primitive cylinders.The same geometry is
referenced to use as bounding objects for collision and automatic calculation of
physics parameters.</p>
<p>The user-accessible parameters include the wheel radius, axle length, body
color, and wheel color.  The kinematics, shape, and physics will parametrically
scale, but the actuator parameters do not change.</p>
<p>The model appears in the ‘party’ project available as a zip file
<a class="reference external" href="https://courses.ideate.cmu.edu/16-375/f2020/zip/party.zip">party.zip</a>.</p>
<div class="figure align-center" id="id2" style="width: 40%">
<a class="reference internal image-reference" href="https://courses.ideate.cmu.edu/16-375/f2020/text/_images/wobbly-sim.jpg"><img alt="../_images/wobbly-sim.jpg" src="Wobbly%20Robot%20Model%20%E2%80%94%20Robotics%20for%20Creative%20Practice%20-%20Fall%202020_files/wobbly-sim.jpg" style="width: 100%;"></a>
<p class="caption"><span class="caption-text">Screenshot of Webots model of a diff-drive ‘wobbly’ robot with low center of gravity.</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#wobbly-robot-model" id="id3">Wobbly Robot Model</a></p>
<ul>
<li><p><a class="reference internal" href="#system-kinematics-and-components" id="id4">System Kinematics and Components</a></p></li>
<li><p><a class="reference internal" href="#wobbly-proto" id="id5">wobbly.proto</a></p></li>
<li><p><a class="reference internal" href="#sample-control-code" id="id6">Sample Control Code</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="system-kinematics-and-components">
<h2><a class="toc-backref" href="#id4">System Kinematics and Components</a><a class="headerlink" href="#system-kinematics-and-components" title="Permalink to this headline">¶</a></h2>
<p>The bodies are as follows:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 15%">
<col style="width: 7%">
<col style="width: 78%">
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>name</p></th>
<th class="head"><p>color</p></th>
<th class="head"><p>notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>body</p></td>
<td><p>blue</p></td>
<td><p>the core solid including counterweight, stalk, axle, and sensor disc</p></td>
</tr>
<tr class="row-odd"><td><p>left wheel</p></td>
<td><p>red</p></td>
<td><p>left wheel disc, cylinder with parameterized radius</p></td>
</tr>
<tr class="row-even"><td><p>right wheel</p></td>
<td><p>red</p></td>
<td><p>right wheel disc, cylinder with parameterized radius</p></td>
</tr>
</tbody>
</table>
<p>The joints are as follows:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 15%">
<col style="width: 7%">
<col style="width: 15%">
<col style="width: 63%">
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>name</p></th>
<th class="head"><p>parent</p></th>
<th class="head"><p>child</p></th>
<th class="head"><p>notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>(6DOF free)</p></td>
<td><p>world</p></td>
<td><p>body</p></td>
<td><p>mobile body; body +X axis is ‘forward’, +Z is ‘up’</p></td>
</tr>
<tr class="row-odd"><td><p>left wheel</p></td>
<td><p>body</p></td>
<td><p>left wheel</p></td>
<td><p>rotational joint on axle, parameterized Z position</p></td>
</tr>
<tr class="row-even"><td><p>right wheel</p></td>
<td><p>body</p></td>
<td><p>right wheel</p></td>
<td><p>rotational joint on axle, parameterized Z position</p></td>
</tr>
</tbody>
</table>
<p>The joint axes are as follows:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 72%">
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>name</p></th>
<th class="head"><p>direction</p></th>
<th class="head"><p>notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>left wheel</p></td>
<td><p>along +Y</p></td>
<td><p>along axle; direction chosen so positive rotation moves forward</p></td>
</tr>
<tr class="row-odd"><td><p>right wheel</p></td>
<td><p>along +Y</p></td>
<td><p>along axle; direction chosen so positive rotation moves forward</p></td>
</tr>
</tbody>
</table>
<p>The motors and sensors are named as follows:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 21%">
<col style="width: 79%">
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>name</p></th>
<th class="head"><p>notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>left wheel motor</p></td>
<td><p>RotationalMotor on left wheel</p></td>
</tr>
<tr class="row-odd"><td><p>right wheel motor</p></td>
<td><p>RotationalMotor on right wheel</p></td>
</tr>
<tr class="row-even"><td><p>left wheel sensor</p></td>
<td><p>PositionSensor on left wheel</p></td>
</tr>
<tr class="row-odd"><td><p>right wheel sensor</p></td>
<td><p>PositionSensor on right wheel</p></td>
</tr>
<tr class="row-even"><td><p>leftDistanceSensor</p></td>
<td><p>DistanceSensor near top of body, aimed left of enter</p></td>
</tr>
<tr class="row-odd"><td><p>rightDistanceSensor</p></td>
<td><p>DistanceSensor near top of body, aimed right of center</p></td>
</tr>
<tr class="row-even"><td><p>gps</p></td>
<td><p>GPS locator mounted on body in center of axle</p></td>
</tr>
<tr class="row-odd"><td><p>compass</p></td>
<td><p>compass mounted on body in center of axle</p></td>
</tr>
<tr class="row-even"><td><p>accelerometer</p></td>
<td><p>three-axis accelerometer mounted on body in center of axle</p></td>
</tr>
<tr class="row-odd"><td><p>receiver</p></td>
<td><p>radio Receiver</p></td>
</tr>
<tr class="row-even"><td><p>emitter</p></td>
<td><p>radio Emitter</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="wobbly-proto">
<h2><a class="toc-backref" href="#id5">wobbly.proto</a><a class="headerlink" href="#wobbly-proto" title="Permalink to this headline">¶</a></h2>
<p>The robot model has been encapsulated in a .proto file for easy reuse.  The
model includes user-accessible scaling and color parameters.</p>
<div class="highlight-console notranslate"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">#</span>VRML_SIM R2020b utf8
<span class="gp">#</span> Two-wheeled differential-drive mobile robot with a low center of gravity.  The
<span class="gp">#</span> body is designed with enough ground clearance to tilt, but the low center of
<span class="gp">#</span> mass will wobble it back upright.  The body includes a mast with two distance
<span class="gp">#</span> sensors, a radio receiver and emitter, and a GPS receiver.  Each wheel has
<span class="gp">#</span> both a rotational motor and a position sensor. The shape is constructed
<span class="gp">#</span> entirely of primitive cylinders.
<span class="gp">#</span> documentation url: https://courses.ideate.cmu.edu/16-375
<span class="gp">#</span> license: No copyright, <span class="m">2020</span> Garth Zeglin.  This file is explicitly placed in the public domain.
<span class="go">PROTO wobbly [</span>
<span class="go">  field SFVec3f    translation  0 0 0</span>
<span class="go">  field SFRotation rotation     0 1 0 0</span>
<span class="go">  field SFString   controller   "wobbly"</span>
<span class="go">  field SFString   name         "Wobbly"</span>
<span class="go">  field SFFloat    wheelRadius  0.1</span>
<span class="go">  field SFFloat    axleLength   0.14</span>
<span class="go">  field SFColor    bodyColor    0.0820075 0.364731 0.8</span>
<span class="go">  field SFColor    wheelColor   1 0 0</span>
<span class="go">  field SFString   customData   ""</span>
<span class="go">]</span>
<span class="go">{</span>
<span class="go">  Robot {</span>
<span class="gp">    #</span> connect properties to user-visible data fields
<span class="go">    translation IS translation</span>
<span class="go">    rotation IS rotation</span>
<span class="go">    controller IS controller</span>
<span class="go">    name IS name</span>
<span class="go">    customData IS customData</span>

<span class="gp">    #</span> calculate derived parameters
<span class="gp">    %</span><span class="o">{</span>
<span class="go">      local counterweightHeight = fields.wheelRadius.value</span>
<span class="go">      local counterweightOffset = 0.75*fields.wheelRadius.value</span>
<span class="go">      local counterweightTop    = 1.25*fields.wheelRadius.value</span>
<span class="go">      local sensorHeight        = 3*fields.wheelRadius.value</span>
<span class="go">      local stalkHeight         = sensorHeight - counterweightTop</span>
<span class="go">      local stalkOffset         = counterweightTop + 0.5*stalkHeight</span>
<span class="go">    }%</span>

<span class="go">    children [</span>
<span class="gp">      #</span> The body group contains three cylinders: the massive counterweight at
<span class="gp">      #</span> bottom, a thin stalk rising above it, topped by the sensor disc.
<span class="gp">      #</span> All these shapes participate in collision<span class="p">;</span> the axle is kept separate
<span class="gp">      #</span> as it is just <span class="k">for</span> rendering.
<span class="go">      DEF bodyShape Group {</span>
<span class="go">        children [</span>
<span class="gp">          #</span> counterweight
<span class="go">          Transform {</span>
<span class="go">            translation 0 0 %{= counterweightOffset }%</span>
<span class="go">            rotation 1 0 0 1.5708</span>
<span class="go">            children [</span>
<span class="go">              Shape {</span>
<span class="go">                appearance DEF bodyAppearance PBRAppearance {</span>
<span class="go">                  baseColor IS bodyColor</span>
<span class="go">                  roughness 0.5</span>
<span class="go">                  metalness 0.5</span>
<span class="go">                }</span>

<span class="go">                geometry Cylinder {</span>
<span class="go">                  height %{= counterweightHeight }%</span>
<span class="go">                  radius 0.05</span>
<span class="go">                }</span>
<span class="go">              }</span>
<span class="go">            ]</span>
<span class="go">          }</span>
<span class="gp">  	  #</span> sensor disc
<span class="go">          Transform {</span>
<span class="go">            translation 0 0 %{= sensorHeight }%</span>
<span class="go">            rotation 1 0 0 1.5708</span>
<span class="go">            children [</span>
<span class="go">              Shape {</span>
<span class="go">                appearance USE bodyAppearance</span>
<span class="go">                geometry Cylinder {</span>
<span class="go">                  height 0.01</span>
<span class="go">                  radius 0.025</span>
<span class="go">                }</span>
<span class="go">              }</span>
<span class="go">            ]</span>
<span class="go">          }</span>
<span class="gp">	  #</span> stalk
<span class="go">          Transform {</span>
<span class="go">            translation 0 0 %{= stalkOffset }%</span>
<span class="go">            rotation 1 0 0 1.5708</span>
<span class="go">            children [</span>
<span class="go">              Shape {</span>
<span class="go">                appearance USE bodyAppearance</span>
<span class="go">                geometry Cylinder {</span>
<span class="go">                  height %{= stalkHeight }%</span>
<span class="go">                  radius 0.01</span>
<span class="go">                }</span>
<span class="go">              }</span>
<span class="go">            ]</span>
<span class="go">          }</span>
<span class="go">        ]</span>
<span class="go">      }</span>
<span class="gp">      #</span> Visible axle shape, not part of the boundingObject.
<span class="go">      DEF axleShape Transform {</span>
<span class="go">        translation 0 0 %{= fields.wheelRadius.value }%</span>
<span class="go">        children [</span>
<span class="go">          Shape {</span>
<span class="go">            appearance USE bodyAppearance</span>
<span class="go">            geometry Cylinder {</span>
<span class="go">              height %{= fields.axleLength.value + 0.02 }%</span>
<span class="go">              radius 0.005</span>
<span class="go">            }</span>
<span class="go">          }</span>
<span class="go">        ]</span>
<span class="go">      }</span>
<span class="gp">      #</span> Define the left wheel axis, pointing in the +Y direction along the axle.
<span class="go">      HingeJoint {</span>
<span class="go">        jointParameters HingeJointParameters {</span>
<span class="go">          axis 0 1 0</span>
<span class="go">          anchor 0 0 %{= fields.wheelRadius.value }%</span>
<span class="go">        }</span>
<span class="go">        device [</span>
<span class="go">          RotationalMotor {</span>
<span class="go">            name "left wheel motor"</span>
<span class="go">            acceleration 10</span>
<span class="go">            maxTorque 2</span>
<span class="go">          }</span>
<span class="go">          PositionSensor {</span>
<span class="go">            name "left wheel sensor"</span>
<span class="go">          }</span>
<span class="go">        ]</span>
<span class="gp">	#</span> Define the left wheel solid, offset along +Y along the axle.
<span class="go">        endPoint DEF leftWheel Solid {</span>
<span class="go">          translation 0 %{= 0.5*fields.axleLength.value }% %{= fields.wheelRadius.value }%</span>
<span class="go">          rotation 0 -1 0 0</span>
<span class="go">          children [</span>
<span class="gp">            #</span> Define the left wheel shape and appearance, which is used by the right wheel solid.
<span class="go">            DEF wheelShape Transform {</span>
<span class="go">              rotation 0 0 1 0</span>
<span class="go">              children [</span>
<span class="go">                Shape {</span>
<span class="go">                  appearance PBRAppearance {</span>
<span class="go">                    baseColor IS wheelColor</span>
<span class="go">                    roughness 0.5</span>
<span class="go">                    metalness 0.5</span>
<span class="go">                  }</span>
<span class="go">                  geometry Cylinder {</span>
<span class="go">                    height 0.01</span>
<span class="go">                    radius %{= fields.wheelRadius.value }%</span>
<span class="go">                  }</span>
<span class="go">                }</span>
<span class="go">              ]</span>
<span class="go">            }</span>
<span class="go">          ]</span>
<span class="go">          name "left wheel"</span>
<span class="go">          boundingObject USE wheelShape</span>
<span class="go">          physics DEF wheelPhysics Physics {</span>
<span class="go">            density 600</span>
<span class="go">          }</span>
<span class="go">        }</span>
<span class="go">      }</span>
<span class="gp">      #</span> Define the right wheel axis, also pointing in the +Y direction along the axle
<span class="gp">      #</span> so positive wheel rotations will move forward.
<span class="go">      HingeJoint {</span>
<span class="go">        jointParameters HingeJointParameters {</span>
<span class="go">          axis 0 1 0</span>
<span class="go">          anchor 0 0 %{= fields.wheelRadius.value }%</span>
<span class="go">        }</span>
<span class="go">        device [</span>
<span class="go">          RotationalMotor {</span>
<span class="go">            name "right wheel motor"</span>
<span class="go">            acceleration 10</span>
<span class="go">            maxTorque 2</span>
<span class="go">          }</span>
<span class="go">          PositionSensor {</span>
<span class="go">            name "right wheel sensor"</span>
<span class="go">          }</span>
<span class="go">        ]</span>
<span class="gp">	#</span> Define the right wheel solid, offset along -Y along the axle.
<span class="gp">	#</span> The wheel shape is inherited from the left wheel.
<span class="go">        endPoint DEF rightWheel Solid {</span>
<span class="go">          translation 0 %{= -0.5*fields.axleLength.value }% %{= fields.wheelRadius.value }%</span>
<span class="go">          rotation 0 0 1 3.14159</span>
<span class="go">          children [</span>
<span class="go">            USE wheelShape</span>
<span class="go">          ]</span>
<span class="go">          name "right wheel"</span>
<span class="go">          boundingObject USE wheelShape</span>
<span class="go">          physics USE wheelPhysics</span>
<span class="go">        }</span>
<span class="go">      }</span>
<span class="gp">      #</span> Define the two range sensors.  They are located on the sensor disc on
<span class="gp">      #</span> top of the body stalk, each pointed off-axis by <span class="m">1</span>.0 radian.
<span class="go">      DEF leftEyeSensor DistanceSensor {</span>
<span class="go">        translation 0.019 0.016 %{= sensorHeight }%</span>
<span class="go">        rotation 0 0 1 0.7</span>
<span class="go">        children [</span>
<span class="go">          DEF eyeShape Transform {</span>
<span class="go">            rotation 0 0 1 1.57</span>
<span class="go">            children [</span>
<span class="go">              Shape {</span>
<span class="go">                appearance PBRAppearance {</span>
<span class="go">                  baseColor 0.975691 0.981481 0.0252992</span>
<span class="go">                  roughness 0.5</span>
<span class="go">                  metalness 0.5</span>
<span class="go">                }</span>
<span class="go">                geometry Cylinder {</span>
<span class="go">                  height 0.004</span>
<span class="go">                  radius 0.005</span>
<span class="go">                }</span>
<span class="go">              }</span>
<span class="go">            ]</span>
<span class="go">          }</span>
<span class="go">        ]</span>
<span class="go">        name "leftDistanceSensor"</span>
<span class="go">        lookupTable [</span>
<span class="go">          0 0.025 0</span>
<span class="go">          1 1 0</span>
<span class="go">        ]</span>
<span class="go">        numberOfRays 2</span>
<span class="go">        aperture 0.4</span>
<span class="go">      }</span>
<span class="go">      DEF rightEyeSensor DistanceSensor {</span>
<span class="go">        translation 0.019 -0.016 %{= sensorHeight }%</span>
<span class="go">        rotation 0 0 1 -0.7</span>
<span class="go">        children [</span>
<span class="go">          USE eyeShape</span>
<span class="go">        ]</span>
<span class="go">        name "rightDistanceSensor"</span>
<span class="go">        lookupTable [</span>
<span class="go">          0 0.025 0</span>
<span class="go">          1 1 0</span>
<span class="go">        ]</span>
<span class="go">        numberOfRays 2</span>
<span class="go">        aperture 0.4</span>
<span class="go">      }</span>
<span class="gp">      #</span> add a default radio receiver and transmitter
<span class="go">      Receiver {</span>
<span class="go">      }</span>
<span class="go">      Emitter {</span>
<span class="go">      }</span>
<span class="gp">      #</span> add a position-sensing <span class="s1">'GPS'</span> device located at the center of the axle
<span class="go">      GPS {</span>
<span class="go">        translation 0 0 %{= fields.wheelRadius.value }%</span>
<span class="go">      }</span>
<span class="gp">      #</span> add a rotation-sensing <span class="s1">'compass'</span> returning only the X and Y components of the North vector
<span class="go">      Compass {</span>
<span class="go">        zAxis FALSE</span>
<span class="go">      }</span>
<span class="gp">      #</span> add an accelerometer located at the center of the axle to measure both gravity and reactive forces
<span class="go">      Accelerometer {</span>
<span class="go">        translation 0 0 %{= fields.wheelRadius.value }%</span>
<span class="go">      }</span>

<span class="go">    ] # close children list of Robot</span>
<span class="go">    boundingObject USE bodyShape</span>
<span class="go">    physics Physics {</span>
<span class="go">      density -1</span>
<span class="go">      mass 3</span>
<span class="go">    }</span>
<span class="go">  } # close Robot</span>
<span class="go">}</span>
</pre></div>
</td></tr></tbody></table></div>
</div>
<div class="section" id="sample-control-code">
<h2><a class="toc-backref" href="#id6">Sample Control Code</a><a class="headerlink" href="#sample-control-code" title="Permalink to this headline">¶</a></h2>
<div class="highlight-Python notranslate"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># wobbly.py</span>

<span class="c1"># Sample Webots controller file for driving the wobbly diff-drive</span>
<span class="c1"># mobile robot.</span>

<span class="c1"># No copyright, 2020, Garth Zeglin.  This file is</span>
<span class="c1"># explicitly placed in the public domain.</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"wobbly.py waking up."</span><span class="p">)</span>

<span class="c1"># Import the Webots simulator API.</span>
<span class="kn">from</span> <span class="nn">controller</span> <span class="kn">import</span> <span class="n">Robot</span>

<span class="c1"># Import standard Python libraries.</span>
<span class="kn">import</span> <span class="nn">math</span><span class="o">,</span> <span class="nn">random</span><span class="o">,</span> <span class="nn">time</span>

<span class="c1"># Define the time step in milliseconds between controller updates.</span>
<span class="n">EVENT_LOOP_DT</span> <span class="o">=</span> <span class="mi">200</span>

<span class="c1">################################################################</span>
<span class="k">class</span> <span class="nc">Wobbly</span><span class="p">(</span><span class="n">Robot</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">Wobbly</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robot_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2">: controller connected."</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">robot_name</span><span class="p">))</span>

        <span class="c1"># Attempt to randomize the random library sequence.</span>
        <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

        <span class="c1"># Initialize geometric constants.  These should match</span>
        <span class="c1"># the current geometry of the robot.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wheel_radius</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axle_length</span>  <span class="o">=</span> <span class="mf">0.14</span>

        <span class="c1"># Fetch handles for the wheel motors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l_motor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMotor</span><span class="p">(</span><span class="s1">'left wheel motor'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_motor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMotor</span><span class="p">(</span><span class="s1">'right wheel motor'</span><span class="p">)</span>

        <span class="c1"># Adjust the low-level controller gains.</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2">: setting PID gains."</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">robot_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l_motor</span><span class="o">.</span><span class="n">setControlPID</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_motor</span><span class="o">.</span><span class="n">setControlPID</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

        <span class="c1"># Fetch handles for the wheel joint sensors.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l_pos_sensor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPositionSensor</span><span class="p">(</span><span class="s1">'left wheel sensor'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_pos_sensor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPositionSensor</span><span class="p">(</span><span class="s1">'right wheel sensor'</span><span class="p">)</span>

        <span class="c1"># Specify the sampling rate for the joint sensors.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l_pos_sensor</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="n">EVENT_LOOP_DT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_pos_sensor</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="n">EVENT_LOOP_DT</span><span class="p">)</span>

        <span class="c1"># Connect to the eye sensors.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l_eye_sensor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDistanceSensor</span><span class="p">(</span><span class="s1">'leftDistanceSensor'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_eye_sensor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDistanceSensor</span><span class="p">(</span><span class="s1">'rightDistanceSensor'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l_eye_sensor</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="n">EVENT_LOOP_DT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_eye_sensor</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="n">EVENT_LOOP_DT</span><span class="p">)</span>

        <span class="c1"># Connect to the radio emitter and receiver.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">receiver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getReceiver</span><span class="p">(</span><span class="s1">'receiver'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emitter</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmitter</span><span class="p">(</span><span class="s1">'emitter'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radio_interval</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radio_timer</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">receiver</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radio_interval</span><span class="p">)</span>

        <span class="c1"># Maintain a table of peer robot locations received over the radio.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">peers</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Connect to the GPS position sensor.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getGPS</span><span class="p">(</span><span class="s1">'gps'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gps_timer</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gps_interval</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gps</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gps_interval</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gps_location</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span> <span class="c1"># reference pose value</span>

        <span class="c1"># Connect to the compass orientation sensor.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCompass</span><span class="p">(</span><span class="s1">'compass'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compass_timer</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compass_interval</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compass</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">compass_interval</span><span class="p">)</span>

        <span class="c1"># State variables for reporting compass readings.  The heading is the</span>
        <span class="c1"># body forward (body +X) direction expressed in degrees clockwise from</span>
        <span class="c1"># North (world +Y).  The compass_vector is the direction of North</span>
        <span class="c1"># expressed in body coordinates.  The neutral pose points East.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heading</span> <span class="o">=</span> <span class="mi">90</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compass_vector</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># reference pose value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heading_error</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Connect to the accelerometer sensor.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accelerometer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAccelerometer</span><span class="p">(</span><span class="s1">'accelerometer'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accelerometer_timer</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accelerometer_interval</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accelerometer</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accelerometer_interval</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accel_vector</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">9.81</span><span class="p">]</span> <span class="c1"># reference pose value</span>

        <span class="c1"># Initialize generic behavior state machine variables.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_timer</span> <span class="o">=</span> <span class="mi">0</span>        <span class="c1"># timers in milliseconds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_index</span> <span class="o">=</span> <span class="mi">0</span>        <span class="c1"># current state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_heading</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_velocity</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span>

    <span class="c1">#================================================================</span>
    <span class="c1"># Polling function to process sensor input at different timescales.</span>
    <span class="k">def</span> <span class="nf">poll_sensors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gps_timer</span> <span class="o">-=</span> <span class="n">EVENT_LOOP_DT</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gps_timer</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gps_timer</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gps_interval</span>
            <span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gps</span><span class="o">.</span><span class="n">getValues</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">location</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gps_location</span> <span class="o">=</span> <span class="n">location</span>
                <span class="c1"># print("%s GPS: %s" % (self.robot_name, location))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">compass_timer</span> <span class="o">-=</span> <span class="n">EVENT_LOOP_DT</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compass_timer</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compass_timer</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compass_interval</span>
            <span class="n">orientation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compass</span><span class="o">.</span><span class="n">getValues</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">orientation</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">orientation</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="c1"># For heading, 0 degrees is North, 90 is East, 180 is South, 270 is West.</span>
                <span class="c1"># The world is assumed configured 'ENU' so X is East and Y is North.</span>
                <span class="c1"># The robot 'front' is along body +X, so the neutral pose is facing East.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">heading</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">fmod</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">orientation</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">orientation</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">180.0</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">compass_vector</span> <span class="o">=</span> <span class="n">orientation</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
                <span class="c1"># print("%s Compass: %s, heading %3.0f deg" % (self.robot_name, self.compass_vector, heading))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">accelerometer_timer</span> <span class="o">-=</span> <span class="n">EVENT_LOOP_DT</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">accelerometer_timer</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">accelerometer_timer</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accelerometer_interval</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">accel_vector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accelerometer</span><span class="o">.</span><span class="n">getValues</span><span class="p">()</span>
            <span class="c1"># The accelerometer will read [0, 0, 9.81] when stationary in the reference pose.</span>
            <span class="c1"># print("%s Accelerometer: %s" % (self.robot_name, self.accel_vector))</span>

        <span class="k">return</span>

    <span class="c1">#================================================================</span>
    <span class="c1"># Polling function to process radio and network input at different timescales.</span>
    <span class="k">def</span> <span class="nf">poll_communication</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radio_timer</span> <span class="o">-=</span> <span class="n">EVENT_LOOP_DT</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">radio_timer</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">radio_timer</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radio_interval</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">receiver</span><span class="o">.</span><span class="n">getQueueLength</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">packet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">receiver</span><span class="o">.</span><span class="n">getData</span><span class="p">()</span>
                <span class="c1"># print("%s Receiver: %s" % (self.robot_name, packet))</span>
                <span class="n">tokens</span> <span class="o">=</span> <span class="n">packet</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2"> malformed packet: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">robot_name</span><span class="p">,</span> <span class="n">packet</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> <span class="c1"># convert bytestring to Unicode</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">peers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2"> receiver: new peer observed: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">robot_name</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">peers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'location'</span> <span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">3</span><span class="p">])],</span>
                                        <span class="s1">'heading'</span>  <span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
                                        <span class="s1">'timestamp'</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTime</span><span class="p">(),</span>
                                        <span class="p">}</span>

                <span class="c1"># done with packet processing</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">receiver</span><span class="o">.</span><span class="n">nextPacket</span><span class="p">()</span>

            <span class="c1"># Transmit a status message at the same rate</span>
            <span class="n">name_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">" "</span><span class="p">,</span><span class="s2">"_"</span><span class="p">)</span>
            <span class="n">status</span> <span class="o">=</span> <span class="s2">"</span><span class="si">%s</span><span class="s2"> </span><span class="si">%.2f</span><span class="s2"> </span><span class="si">%.2f</span><span class="s2"> </span><span class="si">%.2f</span><span class="s2"> </span><span class="si">%.0f</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">name_token</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gps_location</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">gps_location</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                 <span class="bp">self</span><span class="o">.</span><span class="n">gps_location</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">wheel_radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="p">)</span>

            <span class="c1"># emitter requires a bytestring, not a Python Unicode string</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>

            <span class="c1"># print("%s emitter: sending %s" % (self.robot_name, data))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">emitter</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1">#================================================================</span>
    <span class="c1"># motion primitives</span>
    <span class="k">def</span> <span class="nf">go_forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">velocity</span><span class="p">):</span>
        <span class="sd">"""Command the motor to turn at the rate which produce the ground velocity</span>
<span class="sd">           specified in meters/sec.  Negative values turn backward. """</span>

        <span class="c1"># velocity control mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l_motor</span><span class="o">.</span><span class="n">setPosition</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_motor</span><span class="o">.</span><span class="n">setPosition</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

        <span class="c1"># calculate the rotational rate in radians/sec based on the wheel radius</span>
        <span class="n">theta_dot</span> <span class="o">=</span> <span class="n">velocity</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">wheel_radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l_motor</span><span class="o">.</span><span class="n">setVelocity</span><span class="p">(</span><span class="n">theta_dot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_motor</span><span class="o">.</span><span class="n">setVelocity</span><span class="p">(</span><span class="n">theta_dot</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">go_rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rot_velocity</span><span class="p">):</span>
        <span class="sd">"""Command the motors to turn in place at the rate which produce the rotational</span>
<span class="sd">           velocity specified in radians/sec.  Negative values turn</span>
<span class="sd">           backward."""</span>

        <span class="c1"># velocity control mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l_motor</span><span class="o">.</span><span class="n">setPosition</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_motor</span><span class="o">.</span><span class="n">setPosition</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

        <span class="c1"># calculate the difference in linear velocity of the wheels</span>
        <span class="n">linear_velocity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axle_length</span> <span class="o">*</span> <span class="n">rot_velocity</span>

        <span class="c1"># calculate the net rotational rate in radians/sec based on the wheel radius</span>
        <span class="n">theta_dot</span> <span class="o">=</span> <span class="n">linear_velocity</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">wheel_radius</span>

        <span class="c1"># apply the result symmetrically to the wheels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l_motor</span><span class="o">.</span><span class="n">setVelocity</span><span class="p">(</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">theta_dot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_motor</span><span class="o">.</span><span class="n">setVelocity</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">theta_dot</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">heading_difference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">current</span><span class="p">):</span>
        <span class="sd">"""Calculate a directional error in degrees, always returning a value on (-180, 180]."""</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">target</span> <span class="o">-</span> <span class="n">current</span>
        <span class="c1"># fold the range of values to (-180, 180]</span>
        <span class="k">if</span> <span class="n">err</span> <span class="o">&gt;</span> <span class="mf">180.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">err</span> <span class="o">-</span> <span class="mi">360</span>
        <span class="k">elif</span> <span class="n">err</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mf">180.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">err</span> <span class="o">+</span> <span class="mi">360</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">err</span>

    <span class="k">def</span> <span class="nf">go_heading</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_heading</span><span class="p">):</span>
        <span class="sd">"""Rotate toward the heading specifed in positive degrees, with 0 at North (+Y),</span>
<span class="sd">           90 at East (+X).  This assume the compass-reading process is</span>
<span class="sd">           active."""</span>

        <span class="c1"># find the directional error in degrees</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heading_error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading_difference</span><span class="p">(</span><span class="n">target_heading</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="p">)</span>

        <span class="c1"># apply a linear mapping from degrees error to rotational velocity in radians/sec</span>
        <span class="n">rot_vel</span> <span class="o">=</span> <span class="mf">0.02</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading_error</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">go_rotate</span><span class="p">(</span><span class="n">rot_vel</span><span class="p">)</span>
        <span class="c1"># print("go_heading: %f, %f, %f" % (target_heading, self.heading, rot_vel))</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">go_still</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Actively damp any wobble to come to rest in place."""</span>
        <span class="c1"># map an error in X acceleration to a linear velocity</span>
        <span class="n">vel</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">accel_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">go_forward</span><span class="p">(</span><span class="n">vel</span><span class="p">)</span>
        <span class="c1"># print("go_still: %f, %f" % (self.accel_vector[0], vel))</span>
        <span class="k">return</span>

    <span class="c1">#================================================================</span>
    <span class="k">def</span> <span class="nf">peer_heading_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
        <span class="sd">"""Given a peer record, return a tuple (heading, distance) with the compass</span>
<span class="sd">           heading and distance in meters of the peer from this robot current</span>
<span class="sd">           location."""</span>
        <span class="n">loc</span> <span class="o">=</span> <span class="n">record</span><span class="p">[</span><span class="s1">'location'</span><span class="p">]</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">gps_location</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">gps_location</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">*</span><span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span>
        <span class="n">heading</span>  <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">fmod</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">),</span> <span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">180.0</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">heading</span><span class="p">,</span> <span class="n">distance</span>

    <span class="k">def</span> <span class="nf">nearest_peer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="mf">2.0</span><span class="p">):</span>
        <span class="sd">"""Locate the nearest peer (as reported by radio) within the given range.</span>
<span class="sd">           Returns either None or a dictionary with the location record."""</span>
        <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">best</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">peers</span><span class="p">:</span>
            <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="n">heading</span><span class="p">,</span> <span class="n">dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peer_heading_distance</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="n">best</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">record</span>
                <span class="n">best</span> <span class="o">=</span> <span class="n">dist</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="c1">#================================================================</span>
    <span class="k">def</span> <span class="nf">poll_wandering_activity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""State machine update function to aimlessly wander around the world."""</span>

        <span class="c1"># This machine always transitions at regular intervals.</span>
        <span class="n">timer_expired</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_timer</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_timer</span> <span class="o">+=</span> <span class="mi">3000</span>
            <span class="n">timer_expired</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Evaluate the side-effects and transition rules for each state.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"Init state, entering cycle."</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_index</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">go_forward</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">timer_expired</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_index</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">go_heading</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_heading</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">timer_expired</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_index</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">go_still</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">timer_expired</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_index</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">go_rotate</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">6</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">timer_expired</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_index</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">target_heading</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">360</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2">: invalid state, resetting."</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">robot_name</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_index</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">timer_expired</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2">: transitioning to state </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">robot_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_index</span><span class="p">))</span>

        <span class="k">return</span>

    <span class="c1">#================================================================</span>
    <span class="k">def</span> <span class="nf">poll_following_activity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""State machine update function to always move toward the nearest peer."""</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_timer</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_timer</span> <span class="o">+=</span> <span class="mi">1000</span>

            <span class="c1"># periodically test if there is a nearby peer</span>
            <span class="n">nearest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nearest_peer</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">nearest</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_index</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_index</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="n">heading</span><span class="p">,</span> <span class="n">distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peer_heading_distance</span><span class="p">(</span><span class="n">nearest</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">target_heading</span> <span class="o">=</span> <span class="n">heading</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">target_velocity</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">distance</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2">: peer to follow at </span><span class="si">%f</span><span class="s2"> deg, </span><span class="si">%f</span><span class="s2"> meters"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">robot_name</span><span class="p">,</span> <span class="n">heading</span><span class="p">,</span> <span class="n">distance</span><span class="p">))</span>

        <span class="c1"># always either stabilize, turn, or move</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_index</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">go_still</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">heading_err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading_difference</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_heading</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">heading_err</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">20.0</span> <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_velocity</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">go_heading</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_heading</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">go_forward</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_velocity</span><span class="p">)</span>

    <span class="c1">#================================================================</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Run loop to execute a periodic script until the simulation quits.</span>
        <span class="c1"># If the controller returns -1, the simulator is quitting.</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">EVENT_LOOP_DT</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Read simulator clock time.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTime</span><span class="p">()</span>

            <span class="c1"># Read sensor values.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">poll_sensors</span><span class="p">()</span>

            <span class="c1"># Check the radio and/or network.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">poll_communication</span><span class="p">()</span>

            <span class="c1"># Update the activity state machine.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_timer</span> <span class="o">-=</span> <span class="n">EVENT_LOOP_DT</span>

            <span class="c1"># This will run some open-loop motion.  One robot will be the leader, the rest will follow.</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCustomData</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">'leader'</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">poll_wandering_activity</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">poll_following_activity</span><span class="p">()</span>


<span class="c1">################################################################</span>
<span class="c1"># Start the script.</span>
<span class="n">robot</span> <span class="o">=</span> <span class="n">Wobbly</span><span class="p">()</span>
<span class="n">robot</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
</div>
</div>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&nbsp;&nbsp;<a href="https://courses.ideate.cmu.edu/16-375/f2020/text/simulations/clock.html">Clock Robot Model</a>
        &nbsp;&nbsp;::&nbsp;&nbsp;
        <a class="uplink" href="https://courses.ideate.cmu.edu/16-375/f2020/text/index.html">Contents</a>
        &nbsp;&nbsp;::&nbsp;&nbsp;
        <a href="https://courses.ideate.cmu.edu/16-375/f2020/text/simulations/delegate.html">Delegate Robot Model</a>&nbsp;&nbsp;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
        © Copyright 2020, Garth Zeglin. Licensed under <a class="reference external" href="http://creativecommons.org/licenses/by/4.0/">CC-BY-4.0</a>.
      Last updated on 2021-01-26.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.4.
    <a class="reference external" href="https://www.cmu.edu/legal/">University legal notice</a>.
    </div>
  
</body></html>